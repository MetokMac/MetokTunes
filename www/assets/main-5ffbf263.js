(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();const w={apiKey:"AIzaSyBweoLvMv4WERAc31PGM9-8k19RXR1PcGg",authDomain:"metoktunes.firebaseapp.com",projectId:"metoktunes",storageBucket:"metoktunes.firebasestorage.app",messagingSenderId:"683773038647",appId:"1:683773038647:web:d2fbdb4496535737ce6fb2",measurementId:"G-5G1NJ3SZ13"},c={config:w,initialize(){try{const e=initializeApp(this.config);return this.auth=getAuth(e),this.db=getFirestore(e),this.storage=getStorage(e),console.log("Firebase initialized successfully"),!0}catch(e){return console.error("Firebase initialization error:",e),!1}},async signIn(e,t){try{return(await signInWithEmailAndPassword(this.auth,e,t)).user}catch(o){throw console.error("Sign in error:",o),o}},async signUp(e,t){try{return(await createUserWithEmailAndPassword(this.auth,e,t)).user}catch(o){throw console.error("Sign up error:",o),o}},async signOut(){try{await signOut(this.auth)}catch(e){throw console.error("Sign out error:",e),e}},async getArtists(){try{const e=collection(this.db,"artists"),t=await getDocs(e),o=[];return t.forEach(r=>{o.push({id:r.id,...r.data()})}),o}catch(e){throw console.error("Error getting artists:",e),e}},async getSongs(){try{const e=collection(this.db,"songs"),t=await getDocs(e),o=[];return t.forEach(r=>{o.push({id:r.id,...r.data()})}),o}catch(e){throw console.error("Error getting songs:",e),e}},async getUserPlaylists(e){try{const t=collection(this.db,"playlists"),o=query(t,where("userId","==",e)),r=await getDocs(o),n=[];return r.forEach(a=>{n.push({id:a.id,...a.data()})}),n}catch(t){throw console.error("Error getting playlists:",t),t}},async uploadSong(e){try{const t=ref(this.storage,`songs/${e.name}`);return await uploadBytes(t,e),await getDownloadURL(t)}catch(t){throw console.error("Error uploading song:",t),t}}};document.addEventListener("DOMContentLoaded",()=>{S()});function S(){const e=document.querySelector("#withdraw-amount"),t=document.querySelector(".method-option#paypal-option"),o=document.querySelector(".method-option#cashapp-option"),r=document.querySelector("#withdraw-form");document.querySelector("#withdraw-balance");const n=document.querySelector("#paypal-details"),a=document.querySelector("#cashapp-details");if(!e||!t||!r){console.error("One or more required elements not found in DOM");return}h(),t&&t.addEventListener("click",()=>{m("paypal")}),o&&o.addEventListener("click",()=>{m("cashapp")}),r&&r.addEventListener("submit",async s=>{s.preventDefault(),await v()});function i(s){n&&(n.style.display=s==="paypal"?"block":"none"),a&&(a.style.display=s==="cashapp"?"block":"none")}i("")}function m(e){e==="paypal"?(document.getElementById("paypal-details").style.display="block",document.getElementById("cashapp-details").style.display="none"):(document.getElementById("cashapp-details").style.display="block",document.getElementById("paypal-details").style.display="none")}async function h(){try{const e=JSON.parse(localStorage.getItem("user"));if(!e){alert("Please log in to view your balance"),window.location.href="login.html";return}const t=await firebase.getAvailableBalance(e.email);withdrawBalance.textContent=`$${t.toFixed(2)}`}catch(e){console.error("Error loading balance:",e),alert("Failed to load balance. Please try again.")}}async function v(){try{const e=JSON.parse(localStorage.getItem("user")),t=parseFloat(document.getElementById("withdraw-amount").value),o=document.getElementById("paypal-option").style.display==="block"?"paypal":"cashapp";if(!e){alert("Please log in to withdraw funds"),window.location.href="login.html";return}if(t<1e5){alert("Minimum withdrawal amount is 100,000 tokens ($0.10)");return}const r=Math.max(5e3,t*.01),n=t-r;if(!confirm(`You are about to withdraw ${t.toLocaleString()} tokens ($${(t/1e6).toFixed(2)})

Fee: ${r.toLocaleString()} tokens ($${(r/1e6).toFixed(2)})
Net amount: ${n.toLocaleString()} tokens ($${(n/1e6).toFixed(2)})

Proceed with withdrawal?`))return;const a=o==="paypal"?{paypalEmail:document.getElementById("paypal-email").value}:{cashappUsername:document.getElementById("cashapp-id").value};await firebase.processWithdrawal(e.email,t,o,a),await firebase.updateUserBalance(e.email,t),alert(`Withdrawal request submitted successfully!

Your funds will be processed ${o==="paypal"?"1-3 business days":"Instant"}.`),h(),window.location.href="ad-revenue-history.html"}catch(e){console.error("Error processing withdrawal:",e),alert("Failed to process withdrawal. Please try again.")}}document.addEventListener("DOMContentLoaded",()=>{E()});function E(){document.getElementById("donate-button");const e=document.querySelectorAll(".amount-btn"),t=document.getElementById("custom-amount"),o=document.getElementById("confirm-donation"),r=document.getElementById("artist-name").dataset.artistId;e.forEach(n=>{n.addEventListener("click",()=>{t.value=n.dataset.amount})}),t.addEventListener("input",n=>{const a=parseInt(n.target.value);(isNaN(a)||a<1e6)&&(n.target.value="")}),o.addEventListener("click",async()=>{const n=parseInt(t.value);if(!n||isNaN(n)){alert("Please enter a valid amount");return}const a=JSON.parse(localStorage.getItem("user"));if(!a){alert("Please log in to make a donation");return}try{const s=await firebase.getAvailableBalance(a.email)*TOKEN_CONVERSION_RATE;if(s<n){alert("Insufficient tokens. Please withdraw more tokens first.");return}await firebase.processDonation(a.email,r,n),await firebase.updateUserBalance(a.email,s-n),await firebase.updateArtistBalance(r,n),alert(`Successfully donated ${n.toLocaleString()} tokens to the artist!`),window.location.reload()}catch(i){console.error("Error processing donation:",i),alert("Failed to process donation. Please try again.")}})}if("serviceWorker"in navigator)try{navigator.serviceWorker.register("/sw.js").then(()=>{console.log("Service Worker registered successfully")})}catch(e){console.error("Service Worker registration failed:",e)}const b={apiKey:"YOUR_API_KEY",authDomain:"metoktunes.firebaseapp.com",projectId:"metoktunes",storageBucket:"metoktunes.appspot.com",messagingSenderId:"YOUR_SENDER_ID",appId:"YOUR_APP_ID"};c.initializeApp(b);const d=c.firestore(),I=document.getElementById("login-form"),L=document.getElementById("guest-login"),u=document.getElementById("login-screen");I.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("email").value,o=document.getElementById("password").value;try{t&&o?(localStorage.setItem("user",JSON.stringify({email:t,isGuest:!1,timestamp:Date.now()})),await c.initializeUserBalance(t),u.style.display="none",y()):alert("Please enter both email and password")}catch(r){console.error("Login error:",r),alert("Login failed. Please try again.")}});L.addEventListener("click",e=>{e.preventDefault(),localStorage.setItem("user",JSON.stringify({email:"guest@metoktunes.com",isGuest:!0,timestamp:Date.now()})),u.style.display="none",y()});function y(){u.style.display="none";const e=document.querySelector("body > :not(#login-screen)");if(e){e.style.display="block",f();const t=JSON.parse(localStorage.getItem("user"));t&&!t.isGuest&&c.loadUserBalance(t.email)}}function f(){console.log("Music player initialized")}function B(){console.log("Notifications initialized")}function D(){console.log("Features initialized")}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOMContentLoaded event triggered"),c.initialize(),window.MusicPlayer.getInstance(),paypal.Buttons({style:{layout:"horizontal",color:"blue",shape:"rect",label:"pay"}}).render("#paypal-button-container"),console.log("Firebase initialized:",{app,db:d,auth,storage}),f(),B(),D(),k(),P(),document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",o=>{o.preventDefault(),console.log("Navigating to:",t.textContent)})})});async function k(){try{console.log("🎵 Starting fetchRecommendedSongs...");const e=collection(d,"songs");console.log("📚 Songs collection reference:",e);const t=query(e);console.log("🔍 Query created:",t);const o=await getDocs(t);console.log("📊 Query snapshot:",o),console.log(`📊 Found ${o.size} songs in database`);const r=document.getElementById("recommended-songs");if(!r){console.error("❌ Could not find recommended-songs container");return}r.innerHTML="",console.log("🧹 Cleared existing recommendations");for(const n of o.docs){const a=n.data();console.log("🎵 Processing song:",a.title),a.title==="Heaven Sent"&&(console.log("🎵 Special logging for Heaven Sent:"),console.log("🎵 Heaven Sent storage path:",a.storagePath),console.log("🎵 Heaven Sent data:",a));const i=await getAudioUrl(a.storagePath);a.title==="Heaven Sent"&&console.log("🎵 Heaven Sent audio URL result:",i);const s=document.createElement("div");s.innerHTML=`
                <strong>${a.title}</strong> by ${a.artist}
                ${i?`
                    <audio controls>
                        <source src="${i}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                `:"No audio available"}
            `,r.appendChild(s),console.log("🎵 Added song to container")}console.log("✅ Finished fetching and displaying recommended songs")}catch(e){console.error("❌ Error in fetchRecommendedSongs:",e)}}async function p(e){try{console.log(`🔍 Searching for: ${e}`);const t=collection(d,"songs"),o=await getDocs(t),r=document.getElementById("search-results");if(!r){console.error("Search results div not found");return}if(r.innerHTML="",!e){r.innerHTML="Please enter a search term";return}const n=e.toLowerCase(),a=o.docs.filter(i=>{const s=i.data();return s.title.toLowerCase().includes(n)||s.artist.toLowerCase().includes(n)||s.genre.toLowerCase().includes(n)});if(a.length===0){r.innerHTML="No songs found";return}for(const i of a){const s=i.data(),g=await getAudioUrl(s.storagePath),l=document.createElement("div");l.classList.add("search-result-item"),l.innerHTML=`
                <strong>${s.title}</strong> by ${s.artist} 
                (Genre: ${s.genre})
                ${g?`
                    <audio controls>
                        <source src="${g}" type="audio/mpeg">
                        Your browser does not support the audio element.
                    </audio>
                `:"No audio available"}
            `,r.appendChild(l)}console.log(`Found ${a.length} matching songs`)}catch(t){console.error("Error searching songs:",t);const o=document.getElementById("search-results");o&&(o.innerHTML="An error occurred while searching")}}function P(){const e=document.getElementById("search-input"),t=document.getElementById("search-button");e&&t&&(t.addEventListener("click",()=>{const o=e.value.trim();p(o)}),e.addEventListener("input",()=>{const o=e.value.trim();o.length>2&&p(o)}))}
